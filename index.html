<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Treino de Corrida Intervalado</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #111;
        color: white;
        text-align: center;
        padding: 20px;
    }
    h1 { color: #00eaff; }

    .config-box {
        background: #222;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
    }

    input, select, button {
        width: 100%;
        padding: 12px;
        font-size: 18px;
        margin-top: 10px;
        border-radius: 6px;
        border: none;
    }

    #display {
        font-size: 60px;
        margin-top: 30px;
    }

    #status {
        font-size: 28px;
        margin-top: 10px;
        color: #00ff99;
    }

    .btn-start {
        background: #00eaff;
        color: #000;
        font-weight: bold;
    }
    .btn-stop {
        background: #ff3b3b;
        font-weight: bold;
    }
</style>
</head>
<body>

<h1>Treino Intervalado</h1>

<div class="config-box">
    <label>‚è± Tempo 1 (minutos)</label>
    <input id="t1" type="number" placeholder="Ex: 1" step="0.1" />

    <label>‚è± Tempo 2 (minutos) (opcional)</label>
    <input id="t2" type="number" placeholder="Ex: 1" step="0.1" />

    <label>üîÅ N√∫mero de repeti√ß√µes</label>
    <input id="reps" type="number" placeholder="Ex: 10" />

    <button class="btn-start" onclick="startTraining()">INICIAR TREINO</button>
    <button class="btn-stop" onclick="stopTraining()">PARAR</button>
</div>

<div id="status">Aguardando...</div>
<div id="display">00:00</div>

<audio id="beep">
    <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>

<script>
// -------------------------------
// CORRE√á√ÉO: EVENTOS PARA IOS
// -------------------------------
document.addEventListener("touchstart", function(){}, true);
document.addEventListener("click", function(){}, true);

// -------------------------------
// DESBLOQUEIO DE √ÅUDIO NO SAFARI
// -------------------------------
function unlockAudio() {
    return new Promise(resolve => {
        const beep = document.getElementById("beep");
        const playPromise = beep.play();

        if (playPromise !== undefined) {
            playPromise.then(() => {
                beep.pause();
                beep.currentTime = 0;
                resolve();
            }).catch(() => resolve());
        } else {
            resolve();
        }
    });
}

// -------------------------------
// VARI√ÅVEIS
// -------------------------------
let interval = null;
let currentTime = 0;
let phase = 1;
let currentRep = 1;
let t1, t2, reps;
let usingT2 = false;

// -------------------------------
// FUN√á√ïES AUXILIARES
// -------------------------------
function vibrate() {
    try { navigator.vibrate([300, 200, 300]); } catch(e) {}
}

function playBeep() {
    const beep = document.getElementById("beep");
    beep.currentTime = 0;
    beep.play();
}

function updateDisplay() {
    let m = String(Math.floor(currentTime / 60)).padStart(2, '0');
    let s = String(currentTime % 60).padStart(2, '0');
    document.getElementById('display').innerText = `${m}:${s}`;
}

function stopTraining() {
    clearInterval(interval);
    document.getElementById("status").innerText = "Treino parado ‚ùó";
}

// -------------------------------
// FUN√á√ÉO INICIAR (CORRIGIDA)
// -------------------------------
window.startTraining = async function() {

    await unlockAudio(); // desbloqueia √°udio no iPhone

    let t1m = parseFloat(document.getElementById("t1").value);
    let t2m = parseFloat(document.getElementById("t2").value);
    reps = parseInt(document.getElementById("reps").value);

    if (!t1m || !reps) {
        alert("Preencha Tempo 1 e Repeti√ß√µes.");
        return;
    }

    t1 = Math.round(t1m * 60);
    t2 = Math.round(t2m * 60);
    usingT2 = !isNaN(t2m) && t2m > 0;

    currentRep = 1;
    phase = 1;
    currentTime = t1;

    runTimer();
};

// -------------------------------
// TIMER PRINCIPAL
// -------------------------------
function runTimer() {
    clearInterval(interval);

    function tick() {
        updateDisplay();

        if (currentTime <= 0) {
            playBeep();
            vibrate();

            // fase 1 ‚Üí fase 2
            if (phase === 1 && usingT2) {
                phase = 2;
                currentTime = t2;
                document.getElementById("status").innerText =
                    `Rep ${currentRep} ‚Äì Tempo 2`;
                return;
            }

            // fase 2 ‚Üí pr√≥xima repeti√ß√£o
            if (phase === 2 || !usingT2) {
                currentRep++;
                if (currentRep > reps) {
                    clearInterval(interval);
                    document.getElementById("status").innerText =
                        "Treino Finalizado ‚úîÔ∏è";
                    document.getElementById("display").innerText = "00:00";
                    playBeep();
                    vibrate();
                    return;
                }

                phase = 1;
                currentTime = t1;
                document.getElementById("status").innerText =
                    `Rep ${currentRep} ‚Äì Tempo 1`;
                return;
            }
        }

        currentTime--;
    }

    document.getElementById("status").innerText = "Rep 1 ‚Äì Tempo 1";
    interval = setInterval(tick, 1000);
}
</script>

</body>
</html>
